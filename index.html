<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>KIEN_ƒê·ªåC FILE PDF</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>üì¶ T√°ch t·ª´ng m√£ ƒë∆°n (tr√™n A4) th√†nh t·ª´ng trang A6</h2>
  <input type="file" id="fileInput" accept="application/pdf">
  <button onclick="splitPDF()">X·ª≠ l√Ω PDF</button>

  <div id="result" style="margin-top: 30px;"></div>

  <script>
    async function splitPDF() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        alert("Vui l√≤ng ch·ªçn file PDF.");
        return;
      }

      const arrayBuffer = await file.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const newPdf = await PDFLib.PDFDocument.create();

      const numPages = pdfDoc.getPageCount();

      // K√≠ch th∆∞·ªõc A6 chu·∫©n B·∫Øc M·ªπ (4x6 inch)
      const a6Width = 4 * 72;  // 4 inch = 4 * 72 pt
      const a6Height = 6 * 72; // 6 inch = 6 * 72 pt

      // K√≠ch th∆∞·ªõc A4 chu·∫©n (595px x 842px)
      const a4Width = 595; // Chi·ªÅu r·ªông A4 (px)
      const a4Height = 842; // Chi·ªÅu cao A4 (px)

      // K√≠ch th∆∞·ªõc m·ªói m√£ ƒë∆°n tr√™n A4, chia th√†nh 2 c·ªôt v√† 2 h√†ng
      const columnWidth = a4Width / 2; // 297.5px
      const rowHeight = a4Height / 2; // 421px

      // X·ª≠ l√Ω t·ª´ng trang trong file PDF g·ªëc
      for (let i = 0; i < numPages; i++) {
        const page = pdfDoc.getPage(i);

        // C·∫Øt m√£ ƒë∆°n t·ª´ t·ªù A4 v√† t·∫°o c√°c trang A6
        for (let row = 0; row < 2; row++) {
          for (let col = 0; col < 2; col++) {
            const newPage = newPdf.addPage([a6Width, a6Height]); // T·∫°o m·ªôt trang A6 m·ªõi

            // T√≠nh to√°n v·ªã tr√≠ c·ªßa t·ª´ng m√£ ƒë∆°n tr√™n t·ªù A4
            const left = col * columnWidth;
            const bottom = row * rowHeight;
            const right = left + columnWidth;
            const top = bottom + rowHeight;

            // C·∫Øt m√£ ƒë∆°n t·ª´ t·ªù A4 v√† d√°n v√†o trang A6
            const [embeddedPage] = await newPdf.embedPages([page], [{
              left: left,
              bottom: bottom,
              right: right,
              top: top
            }]);

            // ƒê∆∞a m√£ ƒë∆°n v√†o trang A6 v·ªõi k√≠ch th∆∞·ªõc ch√≠nh x√°c
            newPage.drawPage(embeddedPage, {
              x: 0,
              y: 0,
              width: a6Width,    // ƒê·∫£m b·∫£o v·ª´a kh·ªõp v·ªõi k√≠ch th∆∞·ªõc A6
              height: a6Height   // ƒê·∫£m b·∫£o v·ª´a kh·ªõp v·ªõi k√≠ch th∆∞·ªõc A6
            });
          }
        }
      }

      // T·∫°o v√† t·∫£i PDF m·ªõi
      const pdfBytes = await newPdf.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);

      document.getElementById('result').innerHTML = `
        <h3>‚úÖ ƒê√£ t·∫°o file PDF m·ªõi (m·ªói m√£ ƒë∆°n 1 trang A6)</h3>
        <a href="${url}" download="ma-don-a6.pdf" target="_blank">üì• T·∫£i file</a>
        <iframe src="${url}" width="100%" height="600px" style="margin-top: 20px;"></iframe>
      `;
    }
  </script>
</body>
</html>
